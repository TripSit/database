{"version":3,"sources":["../src/user.js"],"names":["argon","require","module","exports","createUserQueries","knex","createUser","password","user","hash","insert","returning","then","newUser","authenticate","nick","select","where","first","record","verify"],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,KAAK,GAAGC,OAAO,CAAC,QAAD,CAArB;;AAEAC,MAAM,CAACC,OAAP,GAAiB,SAASC,iBAAT,CAA2BC,IAA3B,EAAiC;AAChD,SAAO;AACCC,IAAAA,UADD,4BACmC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAArBC,gBAAAA,QAAqB,QAArBA,QAAqB,EAARC,IAAQ;AAAA,8BAC/BH,IAAI,CAAC,MAAD,CAD2B;AAAA;AAAA,gDAG/BG,IAH+B;AAAA;AAAA;AAAA,uBAIlBR,KAAK,CAACS,IAAN,CAAWF,QAAX,CAJkB;;AAAA;AAAA;AAAA;AAIlCA,kBAAAA,QAJkC;AAAA;AAAA;AAAA,6DAEnCG,MAFmC,gCAMnCC,SANmC,CAMzB,CAAC,IAAD,EAAO,MAAP,EAAe,WAAf,CANyB,EAOnCC,IAPmC,CAO9B;AAAA;AAAA,sBAAEC,OAAF;;AAAA,yBAAeA,OAAf;AAAA,iBAP8B;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQvC,KATI;AAWCC,IAAAA,YAXD,wBAWcC,IAXd,EAWoBR,QAXpB,EAW8B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACdF,IAAI,CAAC,OAAD,CAAJ,CAChBW,MADgB,CACT,UADS,EAEhBC,KAFgB,CAEV,MAFU,EAEFF,IAFE,EAGhBG,KAHgB,GAIhBN,IAJgB,CAIX,UAAAO,MAAM;AAAA,yBAAIA,MAAJ,aAAIA,MAAJ,uBAAIA,MAAM,CAAEZ,QAAZ;AAAA,iBAJK,CADc;;AAAA;AAC3BE,gBAAAA,IAD2B;;AAAA,oBAO5BA,IAP4B;AAAA;AAAA;AAAA;;AAAA,kDAOf,KAPe;;AAAA;AAAA,kDAQ1BT,KAAK,CAACoB,MAAN,CAAaX,IAAb,EAAmBF,QAAnB,CAR0B;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASlC;AApBI,GAAP;AAsBD,CAvBD","sourcesContent":["'use strict';\n\nconst argon = require('argon2');\n\nmodule.exports = function createUserQueries(knex) {\n  return {\n    async createUser({ password, ...user }) {\n      return knex('usrs')\n        .insert({\n          ...user,\n          password: await argon.hash(password),\n        })\n        .returning(['id', 'nick', 'createdAt'])\n        .then(([newUser]) => newUser);\n    },\n\n    async authenticate(nick, password) {\n      const hash = await knex('users')\n        .select('password')\n        .where('nick', nick)\n        .first()\n        .then(record => record?.password);\n\n      if (!hash) return false;\n      return argon.verify(hash, password);\n    },\n  };\n};\n"],"file":"user.js"}